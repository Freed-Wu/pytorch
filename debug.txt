torch.Size([8960, 16, 64])
torch.Size([8, 16, 1856, 64])
in bwd
varlen_q.grad: tensor([[[ 0.0113,  0.0113, -0.0098,  ...,  0.0053,  0.0071, -0.0062],
         [ 0.0067,  0.0004,  0.0110,  ...,  0.0082,  0.0149, -0.0026],
         [-0.0079, -0.0016, -0.0080,  ..., -0.0051, -0.0049,  0.0182],
         ...,
         [-0.0036, -0.0132,  0.0015,  ...,  0.0322, -0.0073, -0.0122],
         [ 0.0071,  0.0100, -0.0101,  ..., -0.0019, -0.0019, -0.0099],
         [ 0.0223,  0.0014,  0.0114,  ..., -0.0029, -0.0002, -0.0183]],

        [[ 0.0087,  0.0075, -0.0123,  ...,  0.0101,  0.0051, -0.0027],
         [ 0.0009,  0.0007,  0.0057,  ...,  0.0160,  0.0007, -0.0156],
         [-0.0113, -0.0064, -0.0123,  ..., -0.0024, -0.0019,  0.0082],
         ...,
         [-0.0016, -0.0084,  0.0052,  ...,  0.0371, -0.0122, -0.0161],
         [ 0.0098,  0.0068,  0.0106,  ..., -0.0092, -0.0007, -0.0018],
         [ 0.0187, -0.0009,  0.0128,  ..., -0.0067, -0.0001, -0.0094]],

        [[ 0.0108,  0.0115, -0.0084,  ...,  0.0061,  0.0016, -0.0030],
         [ 0.0040,  0.0026,  0.0083,  ...,  0.0084,  0.0089, -0.0061],
         [-0.0096,  0.0048, -0.0090,  ..., -0.0072, -0.0037,  0.0157],
         ...,
         [-0.0023, -0.0157,  0.0040,  ...,  0.0393, -0.0115, -0.0065],
         [ 0.0061,  0.0136, -0.0046,  ...,  0.0014, -0.0061, -0.0086],
         [ 0.0214, -0.0003,  0.0092,  ..., -0.0042, -0.0060, -0.0132]],

        ...,

        [[-0.0065,  0.0089,  0.0013,  ...,  0.0166, -0.0039,  0.0123],
         [ 0.0027,  0.0009,  0.0016,  ..., -0.0011,  0.0082, -0.0021],
         [-0.0049,  0.0061, -0.0022,  ..., -0.0065,  0.0045, -0.0008],
         ...,
         [-0.0113, -0.0060, -0.0084,  ...,  0.0101, -0.0084,  0.0091],
         [ 0.0012,  0.0112,  0.0060,  ...,  0.0045, -0.0095, -0.0016],
         [ 0.0045,  0.0106, -0.0082,  ..., -0.0056, -0.0060, -0.0082]],

        [[-0.0054,  0.0084,  0.0015,  ...,  0.0142, -0.0040,  0.0168],
         [ 0.0002,  0.0033,  0.0018,  ..., -0.0033,  0.0090,  0.0024],
         [-0.0039,  0.0068,  0.0014,  ..., -0.0081,  0.0045,  0.0001],
         ...,
         [-0.0101, -0.0114, -0.0065,  ...,  0.0128, -0.0029,  0.0068],
         [ 0.0028,  0.0120,  0.0057,  ...,  0.0031, -0.0089, -0.0048],
         [ 0.0003,  0.0070, -0.0109,  ..., -0.0055, -0.0027, -0.0082]],

        [[-0.0091,  0.0068,  0.0046,  ...,  0.0118, -0.0043,  0.0112],
         [-0.0001,  0.0024,  0.0031,  ..., -0.0055,  0.0056, -0.0013],
         [-0.0066,  0.0067, -0.0044,  ..., -0.0056,  0.0022,  0.0022],
         ...,
         [-0.0141, -0.0061, -0.0033,  ...,  0.0072, -0.0089,  0.0110],
         [ 0.0047,  0.0125,  0.0090,  ...,  0.0013, -0.0085, -0.0020],
         [ 0.0072,  0.0094, -0.0078,  ..., -0.0034, -0.0064, -0.0089]]],
       device='cuda:0', dtype=torch.bfloat16)
varlen_k.grad: tensor([[[-2.4658e-02, -6.3477e-02,  3.3936e-02,  ...,  3.2959e-02,
          -1.0315e-02,  1.7944e-02],
         [-1.1597e-02, -4.6692e-03,  6.3782e-03,  ..., -1.4465e-02,
          -1.3062e-02, -6.8665e-03],
         [-2.9297e-03, -9.3384e-03,  1.5747e-02,  ..., -1.1841e-02,
          -1.7334e-02,  1.5564e-02],
         ...,
         [-2.0386e-02, -6.1798e-04,  5.8365e-04,  ...,  7.1106e-03,
           1.0376e-02,  2.7954e-02],
         [-1.1536e-02, -4.5776e-03,  7.1716e-03,  ...,  3.4180e-02,
           3.1891e-03,  1.0315e-02],
         [ 4.2725e-03,  1.1475e-02, -2.9945e-04,  ..., -4.6387e-03,
          -2.7847e-04,  9.3994e-03]],

        [[ 5.6458e-04,  1.1597e-02,  1.5945e-03,  ..., -1.0803e-02,
           6.6528e-03, -2.4872e-03],
         [ 1.0132e-02, -2.0599e-03,  1.5747e-02,  ..., -8.6670e-03,
          -1.0620e-02, -1.6113e-02],
         [-1.0757e-03,  1.7212e-02,  5.3711e-03,  ...,  9.6436e-03,
           2.0264e-02, -1.1475e-02],
         ...,
         [ 9.8267e-03, -5.1880e-03,  8.6975e-04,  ..., -1.7242e-03,
          -2.6245e-03, -2.6245e-03],
         [-1.3306e-02, -1.5564e-02,  5.9509e-03,  ...,  1.0315e-02,
           1.0803e-02, -5.7373e-03],
         [-5.1117e-04, -6.9809e-04, -1.3447e-04,  ...,  6.9580e-03,
          -4.2534e-04,  2.6245e-03]],

        [[ 2.9602e-03,  3.5248e-03, -3.0365e-03,  ..., -1.3733e-03,
           1.7929e-03,  1.0300e-03],
         [-5.5542e-03,  6.7139e-04,  1.1292e-03,  ..., -8.7891e-03,
           6.6757e-04, -9.7046e-03],
         [ 2.6321e-04,  2.3956e-03, -7.9727e-04,  ...,  1.1292e-03,
           1.1520e-03, -1.4725e-03],
         ...,
         [-1.2146e-02,  1.3367e-02,  1.3924e-04,  ...,  1.1414e-02,
           9.7656e-03,  1.5259e-02],
         [ 3.6316e-03,  7.6599e-03,  4.5471e-03,  ..., -8.6060e-03,
          -7.2021e-03, -1.0605e-03],
         [ 1.7822e-02,  1.6235e-02, -1.9287e-02,  ..., -1.7334e-02,
           9.6436e-03,  1.7334e-02]],

        ...,

        [[-1.2207e-04,  2.3556e-04, -3.2425e-04,  ..., -6.9427e-04,
           8.6212e-04, -6.2561e-04],
         [ 2.0020e-02, -1.6357e-02,  8.8501e-03,  ..., -2.3071e-02,
          -7.4158e-03, -1.3428e-02],
         [-1.4099e-02, -5.3711e-03, -2.0386e-02,  ..., -5.1575e-03,
           1.0986e-02,  8.6594e-04],
         ...,
         [ 2.6245e-03,  1.0223e-03, -3.6163e-03,  ..., -2.1973e-03,
           1.7014e-03, -2.9907e-03],
         [ 3.3722e-03,  2.4567e-03,  1.1673e-03,  ...,  3.9673e-03,
           3.3188e-04, -2.4128e-04],
         [ 3.2806e-04,  3.5477e-04,  6.8665e-04,  ...,  7.6675e-04,
           8.6975e-04,  1.9989e-03]],

        [[-1.5869e-02,  3.1250e-02, -1.0620e-02,  ..., -9.7046e-03,
           1.4282e-02, -4.3701e-02],
         [-1.4267e-03, -4.6692e-03, -5.4626e-03,  ...,  2.8687e-03,
           5.0659e-03, -1.5411e-03],
         [-2.2095e-02,  9.4604e-03, -2.2827e-02,  ...,  6.6528e-03,
          -1.2756e-02, -1.9531e-02],
         ...,
         [-3.3569e-03,  3.5858e-03,  7.7057e-04,  ...,  6.3705e-04,
          -3.8452e-03,  4.8828e-03],
         [-2.0599e-03, -1.4343e-03, -1.0315e-02,  ..., -3.0975e-03,
           8.1787e-03,  3.2196e-03],
         [-1.0010e-02, -1.6235e-02,  1.1475e-02,  ..., -1.3611e-02,
          -1.6785e-03,  8.2397e-03]],

        [[ 7.6904e-03, -8.3008e-03,  1.0132e-02,  ..., -1.3809e-03,
           2.4719e-03,  5.7373e-03],
         [-1.1841e-02, -3.3417e-03,  8.7280e-03,  ..., -7.2861e-04,
           2.9297e-02,  7.2021e-03],
         [-7.2632e-03, -2.7008e-03, -1.7853e-03,  ..., -2.9602e-03,
           4.4556e-03, -2.5330e-03],
         ...,
         [ 2.7275e-04,  3.2234e-04,  2.9373e-04,  ..., -4.7493e-04,
           3.4714e-04, -4.5395e-04],
         [ 1.1250e-06,  1.3065e-04,  3.0708e-04,  ...,  1.5488e-03,
           1.9836e-03,  1.8616e-03],
         [ 2.2583e-03,  6.5613e-04,  2.6550e-03,  ...,  1.7548e-03,
          -2.6550e-03,  1.2207e-03]]], device='cuda:0', dtype=torch.bfloat16)
varlen_grad_seq: tensor([[ 0.2393, -0.0811, -0.1641,  ...,  0.2871, -0.1602, -0.5938],
        [ 0.2373, -0.0608, -0.1699,  ...,  0.2871, -0.1387, -0.6133],
        [ 0.2334, -0.0874, -0.1709,  ...,  0.3145, -0.1475, -0.6211],
        ...,
        [ 0.2324, -0.0757, -0.1631,  ...,  0.2812, -0.1475, -0.6094],
        [ 0.2236, -0.0835, -0.1572,  ...,  0.2949, -0.1582, -0.5938],
        [ 0.2412, -0.0962, -0.1602,  ...,  0.3125, -0.1582, -0.6133]],
       device='cuda:0', dtype=torch.bfloat16)
sdpa_grad_seq: tensor([[ 0.0603, -0.0205, -0.0413,  ...,  0.0718, -0.0400, -0.1494],
        [ 0.0598, -0.0156, -0.0430,  ...,  0.0723, -0.0347, -0.1543],
        [ 0.0586, -0.0219, -0.0430,  ...,  0.0786, -0.0366, -0.1562],
        ...,
        [ 0.0586, -0.0193, -0.0413,  ...,  0.0713, -0.0369, -0.1533],
        [ 0.0564, -0.0211, -0.0393,  ...,  0.0742, -0.0396, -0.1494],
        [ 0.0610, -0.0239, -0.0403,  ...,  0.0786, -0.0393, -0.1543]],
       device='cuda:0', dtype=torch.bfloat16)
