build:
  build_target: vllm
  artifact_dir: shared
  torch_whl_dir: dist
  # if set, overrides the base image used in vllm build
  base_image: ${DOCKER_IMAGE}
  # if set, replaces the vllm dockerfile.torch_nightly with the local dockerfile.
  dockerfile_path: "./.github/docker/external/vllm/Dockerfile.base"
test:
  - label: Basic Correctness Test # 30min
    id: vllm_basic_correctness_test
    tests:
    - env_var: VLLM_WORKER_MULTIPROC_METHOD=spawn
      op: globle_env
    - command: pytest -v -s basic_correctness/test_cumem.py
    - command: pytest -v -s basic_correctness/test_basic_correctness.py
    - command: pytest -v -s basic_correctness/test_cpu_offload.py
    - command: pytest -v -s basic_correctness/test_preemption.py
      env_var: VLLM_TEST_ENABLE_ARTIFICIAL_PREEMPT=1
